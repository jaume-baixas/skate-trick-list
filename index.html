<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seguiment de Trucs - Firebase</title>
<style>
  body { font-family: -apple-system, sans-serif; background:#F3F4F6; padding:20px; }
  .container { max-width:1200px; margin:auto; background:white; padding:20px; border-radius:15px; }
  table { width:100%; border-collapse:collapse; min-width:600px; }
  th, td { padding:10px; border-bottom:1px solid #E5E7EB; }
  th.sticky { position:sticky; left:0; background:white; z-index:5; }
  .level-badge { padding:4px 12px; border-radius:12px; font-size:0.75em; font-weight:600; }
  .level-facil { background:#D1FAE5; color:#065F46; }
  .level-mitja { background:#FED7AA; color:#9A3412; }
  .level-dificil { background:#FEE2E2; color:#991B1B; }
  select { padding:6px 10px; border-radius:6px; border:2px solid #E5E7EB; }
  button { cursor:pointer; border:none; border-radius:8px; padding:6px 12px; }
  .btn-add { background:white; border:2px solid #E5E7EB; }
  .btn-add:hover { border-color:#4F46E5; }
  .delete-btn { color:red; font-weight:bold; margin-left:5px; }
  .progress-bar { height:10px; border-radius:5px; overflow:hidden; margin-top:5px; background:#E5E7EB; }
  .progress-fill { height:100%; transition:width 0.3s; }
</style>
</head>
<body>
<div class="container">
<h1>ðŸ›¹ Seguiment de Trucs</h1>

<div>
  <button class="btn-add" onclick="openAddTrickModal()">âž• Afegir Truc</button>
  <button class="btn-add" onclick="openAddWeekModal()">âž• Afegir Setmana</button>
</div>

<div style="overflow-x:auto; margin-top:20px;">
<table id="tricksTable">
<thead>
<tr id="tableHeader">
  <th class="sticky">Truc</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<h2>ðŸ“Š Resum de Progressos</h2>
<div id="summary"></div>
</div>

<!-- Modal Afegir Truc -->
<div id="addTrickModal" style="display:none;">
  <input type="text" id="trickNameInput" placeholder="Nom del truc...">
  <select id="trickLevelSelect">
    <option value="facil">FÃ cil</option>
    <option value="mitja">MitjÃ </option>
    <option value="dificil">DifÃ­cil</option>
  </select>
  <button onclick="addTrick()">Afegir</button>
  <button onclick="closeModal('addTrickModal')">CancelÂ·lar</button>
</div>

<!-- Modal Afegir Setmana -->
<div id="addWeekModal" style="display:none;">
  <input type="text" id="weekNameInput" placeholder="Nom de la setmana (ex: Setmana 1)">
  <button onclick="addWeek()">Afegir</button>
  <button onclick="closeModal('addWeekModal')">CancelÂ·lar</button>
</div>

<script type="module">
  // Firebase config
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "skate-tricks-list.firebaseapp.com",
    databaseURL: "https://skate-tricks-list-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "skate-tricks-list",
    storageBucket: "skate-tricks-list.appspot.com",
    messagingSenderId: "1038259811397",
    appId: "1:1038259811397:web:9534d8788f389c772d9f2c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let data = { weeks: ['Setmana 1'], tricks: [] };

  function saveData() {
    set(ref(db, 'tricksData'), data);
  }

  function loadData() {
    onValue(ref(db, 'tricksData'), (snapshot) => {
      const val = snapshot.val();
      if(val) data = val;
      renderTable();
      renderSummary();
    });
  }

  function renderTable() {
    const header = document.getElementById('tableHeader');
    const body = document.getElementById('tableBody');

    header.innerHTML = '<th class="sticky">Truc</th>';
    data.weeks.forEach((week, idx) => {
      header.innerHTML += `<th>${week} <span class="delete-btn" onclick="deleteWeek(${idx})">âœ•</span></th>`;
    });

    body.innerHTML = '';
    data.tricks.forEach((trick, tIdx) => {
      let row = `<tr><td class="sticky">${trick.name} <span class="level-badge level-${trick.level}">${trick.level}</span> <span class="delete-btn" onclick="deleteTrick(${tIdx})">âœ•</span></td>`;
      data.weeks.forEach((week)=> {
        const attempt = trick.attempts?.[week] || 'â€”';
        row += `<td><select onchange="updateAttempt(${tIdx}, '${week}', this.value)">
          <option value="â€”" ${attempt==='â€”'?'selected':''}>â€”</option>
          <option value="1" ${attempt==='1'?'selected':''}>1</option>
          <option value="2" ${attempt==='2'?'selected':''}>2</option>
          <option value="3" ${attempt==='3'?'selected':''}>3</option>
          <option value="4" ${attempt==='4'?'selected':''}>4</option>
          <option value="5" ${attempt==='5'?'selected':''}>5</option>
        </select></td>`;
      });
      row += '</tr>';
      body.innerHTML += row;
    });
  }

  function renderSummary() {
    const summary = document.getElementById('summary');
    summary.innerHTML = '';
    data.tricks.forEach(trick => {
      let best = 0;
      data.weeks.forEach(week => {
        const val = trick.attempts?.[week] || 'â€”';
        let percent = 0;
        let color = '#9CA3AF';
        if(val==='1'){percent=100;color='#10B981';}
        else if(val==='2'){percent=80;color='#22C55E';}
        else if(val==='3'){percent=60;color='#FACC15';}
        else if(val==='4'){percent=40;color='#F97316';}
        else if(val==='5'){percent=20;color='#F87171';}
        if(percent>best) best = percent;
        summary.innerHTML += `<div>${trick.name} (${week})<div class="progress-bar"><div class="progress-fill" style="width:${percent}%;background:${color}"></div></div></div>`;
      });
    });
  }

  function updateAttempt(trickIndex, week, value){
    data.tricks[trickIndex].attempts[week]=value;
    saveData();
    renderSummary();
  }

  function openAddTrickModal(){document.getElementById('addTrickModal').style.display='block';}
  function openAddWeekModal(){document.getElementById('addWeekModal').style.display='block';}
  function closeModal(id){document.getElementById(id).style.display='none';}

  function addTrick(){
    const name = document.getElementById('trickNameInput').value;
    const level = document.getElementById('trickLevelSelect').value;
    if(name){ data.tricks.push({name, level, attempts:{}}); saveData(); renderTable(); renderSummary(); closeModal('addTrickModal'); }
  }
  function addWeek(){
    const name = document.getElementById('weekNameInput').value;
    if(name){ data.weeks.push(name); saveData(); renderTable(); closeModal('addWeekModal'); }
  }
  function deleteTrick(idx){data.tricks.splice(idx,1); saveData(); renderTable(); renderSummary();}
  function deleteWeek(idx){ const w=data.weeks[idx]; data.weeks.splice(idx,1); data.tricks.forEach(t=>{delete t.attempts[w];}); saveData(); renderTable(); renderSummary();}

  loadData();
</script>
</body>
</html>
