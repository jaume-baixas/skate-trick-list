<!DOCTYPE html>

<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seguiment de Trucs</title>
<style>
/* ---------- ESTILS GENERALS ---------- */
body { font-family: sans-serif; margin: 20px; background: #F3F4F6; }
.container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
h1 { color: #1F2937; margin-bottom: 10px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { padding: 12px; border-bottom: 1px solid #E5E7EB; text-align: left; }
th { background: #F9FAFB; position: sticky; top: 0; }
.level-badge { padding: 4px 12px; border-radius: 12px; font-weight: 600; text-transform: uppercase; font-size: 0.75em; }
.level-facil { background: #D1FAE5; color: #065F46; }
.level-mitja { background: #FED7AA; color: #9A3412; }
.level-dificil { background: #FEE2E2; color: #991B1B; }
button { padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer; margin: 5px; }
.btn-primary { background: #4F46E5; color: white; }
.btn-secondary { background: #E5E7EB; color: #374151; }
.modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal.active { display:flex; }
.modal-content { background:white; padding:20px; border-radius:15px; max-width:400px; width:90%; }
.modal-content input, .modal-content select { width:100%; margin-bottom:10px; padding:8px; border-radius:8px; border:2px solid #E5E7EB; }
</style>
</head>
<body>
<div class="container">
  <h1>ðŸ›¹ Seguiment de Trucs</h1>
  <p>Registra els teus progressos sessiÃ³ a sessiÃ³</p>

<select id="skaterSelect"></select> <button id="addSkaterButton">+</button>

  <div>
    <button id="addTrickButton">âž• Afegir Truc</button>
    <button id="addSessionButton">ðŸ“… Afegir SessiÃ³</button>
  </div>

  <div class="table-container">
    <table id="tricksTable">
      <thead>
        <tr>
          <th>Truc</th>
          <th>Nivell</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<!-- MODALS -->

<div class="modal" id="addTrickModal">
  <div class="modal-content">
    <h2>Afegir Nou Truc</h2>
    <input type="text" id="trickNameInput" placeholder="Nom del truc...">
    <select id="trickLevelSelect">
      <option value="facil">FÃ cil</option>
      <option value="mitja" selected>MitjÃ </option>
      <option value="dificil">DifÃ­cil</option>
    </select>
    <button id="cancelAddTrick" class="btn-secondary">CancelÂ·lar</button>
    <button id="confirmAddTrick" class="btn-primary">Afegir</button>
  </div>
</div>

<div class="modal" id="addSkaterModal">
  <div class="modal-content">
    <h2>Afegir Nou Skater</h2>
    <input type="text" id="skaterNameInput" placeholder="Nom del skater...">
    <input type="number" id="skaterAgeInput" placeholder="Edat..." min="1" max="120">
    <button id="cancelAddSkater" class="btn-secondary">CancelÂ·lar</button>
    <button id="confirmAddSkater" class="btn-primary">Afegir</button>
  </div>
</div>

<div class="modal" id="addSessionModal">
  <div class="modal-content">
    <h2>Afegir Nova SessiÃ³</h2>
    <input type="text" id="sessionNameInput" placeholder="Nom de la sessiÃ³...">
    <button id="cancelAddSession" class="btn-secondary">CancelÂ·lar</button>
    <button id="confirmAddSession" class="btn-primary">Afegir</button>
  </div>
</div>

<!-- FIREBASE SCRIPT -->

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDS6yD7l5WHJWylq0fdBaq7zaEV3ahInIs",
  authDomain: "skate-tricks-list.firebaseapp.com",
  databaseURL: "https://skate-tricks-list-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "skate-tricks-list",
  storageBucket: "skate-tricks-list.appspot.com",
  messagingSenderId: "1038259811397",
  appId: "1:1038259811397:web:9534d8788f389c772d9f2c"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
console.log("âœ… Firebase inicialitzat correctament");

window.allData = {
  currentSkater: 'default',
  skaters: { 'default': { name: 'Skater 1', age: null, sessions: ['SessiÃ³ 1'], tricks: [] } }
};

function saveData() {
  const dataRef = ref(db, 'allSkaterData');
  set(dataRef, window.allData)
    .then(()=>console.log("ðŸ’¾ Dades guardades a Firebase"))
    .catch(err=>console.error("âŒ Error guardant a Firebase:", err));
}

const dataRef = ref(db, 'allSkaterData');
onValue(dataRef, snapshot=>{
  if(snapshot.exists()){ window.allData = snapshot.val(); console.log("ðŸ“¥ Dades carregades de Firebase"); }
  else { console.log("âš ï¸ No hi ha dades a Firebase, creant estructura inicial..."); saveData(); }
  updateSkaterList(); renderTable();
});

function updateSkaterList(){
  const select = document.getElementById('skaterSelect'); select.innerHTML='';
  for(const id in window.allData.skaters){
    const skater = window.allData.skaters[id];
    const option = document.createElement('option'); option.value=id;
    option.textContent = skater.name+(skater.age?` (${skater.age} anys)`:'');
    if(id===window.allData.currentSkater) option.selected=true;
    select.appendChild(option);
  }
}

function renderTable(){
  const tbody = document.getElementById('tableBody'); tbody.innerHTML='';
  const data = window.allData.skaters[window.allData.currentSkater];
  data.tricks.forEach((trick,index)=>{
    const tr = document.createElement('tr');
    const levelClass = `level-${trick.level||'mitja'}`;
    tr.innerHTML = `<td>${trick.name}</td><td><span class="level-badge ${levelClass}">${trick.level}</span></td>`;
    tbody.appendChild(tr);
  });
}

/* ---------- MODALS ---------- */
function openModal(id){ document.getElementById(id).classList.add('active'); }
function closeModal(id){ document.getElementById(id).classList.remove('active'); }

document.getElementById('addTrickButton').addEventListener('click',()=>openModal('addTrickModal'));
document.getElementById('addSkaterButton').addEventListener('click',()=>openModal('addSkaterModal'));
document.getElementById('addSessionButton').addEventListener('click',()=>openModal('addSessionModal'));

document.getElementById('cancelAddTrick').addEventListener('click',()=>closeModal('addTrickModal'));
document.getElementById('cancelAddSkater').addEventListener('click',()=>closeModal('addSkaterModal'));
document.getElementById('cancelAddSession').addEventListener('click',()=>closeModal('addSessionModal'));

document.getElementById('confirmAddTrick').addEventListener('click',()=>{
  const name = document.getElementById('trickNameInput').value.trim();
  const level = document.getElementById('trickLevelSelect').value;
  if(name){ window.allData.skaters[window.allData.currentSkater].tricks.push({name,level,attempts:{}}); closeModal('addTrickModal'); saveData(); renderTable(); }
});

document.getElementById('confirmAddSkater').addEventListener('click',()=>{
  const name = document.getElementById('skaterNameInput').value.trim();
  const age = parseInt(document.getElementById('skaterAgeInput').value);
  if(name){
    const id = 'skater_'+Date.now();
    window.allData.skaters[id] = {name, age: age||null, sessions:['SessiÃ³ 1'], tricks:[]};
    window.allData.currentSkater = id;
    closeModal('addSkaterModal'); saveData(); updateSkaterList(); renderTable();
  }
});

document.getElementById('confirmAddSession').addEventListener('click',()=>{
  const name = document.getElementById('sessionNameInput').value.trim();
  if(name){
    const data = window.allData.skaters[window.allData.currentSkater];
    data.sessions.push(name); closeModal('addSessionModal'); saveData();
  }
});
</script>

</body>
</html>
